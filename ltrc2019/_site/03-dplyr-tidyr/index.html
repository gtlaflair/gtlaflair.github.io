















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2019-02-25 23:10:55 -0500">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />

    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/dc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/dc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/dc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/dc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/dc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/dc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/dc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/dc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/dc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Data Carpentry - R for Assessment Specialists"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/dc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/dc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/dc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/dc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/dc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>R for Assessment Specialists: Part 1: Introducing dplyr and tidyr</title>
  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body beta">
    This lesson is being piloted (Beta version)
  </div>
</div>




    <div class="container">
      
<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../00-intro/index.html">Before we Start</a></li>
            
            <li><a href="../01-intro-to-r/index.html">Part 1: Introduction to R</a></li>
            
            <li><a href="../02-starting-with-data/index.html">Part 1: Starting with Data</a></li>
            
            <li><a href="../03-dplyr-tidyr/index.html">Part 1: Introducing dplyr and tidyr</a></li>
            
            <li><a href="../04-ggplot2/index.html">Part 1: Data visualisation with ggplot2</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            <li><a href="../about/index.html">About</a></li>
            
            <li><a href="../discuss/index.html">Discussion</a></li>
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
	
	<li><a href="/edit/gh-pages/_episodes/03-dplyr-tidyr.md">Improve this page <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></li>
	
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>

















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-starting-with-data/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">R for Assessment Specialists</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-ggplot2/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Part 1: Introducing dplyr and tidyr</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br/>
      <strong>Exercises:</strong> 25 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I select specific rows and/or columns from a data frame?</p>
</li>
	
	<li><p>How can I combine multiple commands into a single command?</p>
</li>
	
	<li><p>How can create new columns or remove existing columns from a data frame?</p>
</li>
	
	<li><p>How can I reformat a dataframe to meet my needs?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Describe the purpose of the <strong><code class="highlighter-rouge">dplyr</code></strong> and <strong><code class="highlighter-rouge">tidyr</code></strong> packages.</p>
</li>
	
	<li><p>Select certain columns in a data frame with the <strong><code class="highlighter-rouge">dplyr</code></strong> function <code class="highlighter-rouge">select</code>.</p>
</li>
	
	<li><p>Select certain rows in a data frame according to filtering conditions with the <strong><code class="highlighter-rouge">dplyr</code></strong> function <code class="highlighter-rouge">filter</code>.</p>
</li>
	
	<li><p>Link the output of one <strong><code class="highlighter-rouge">dplyr</code></strong> function to the input of another function with the ‘pipe’ operator <code class="highlighter-rouge">%&gt;%</code>.</p>
</li>
	
	<li><p>Add new columns to a data frame that are functions of existing columns with <code class="highlighter-rouge">mutate</code>.</p>
</li>
	
	<li><p>Use the split-apply-combine concept for data analysis.</p>
</li>
	
	<li><p>Use <code class="highlighter-rouge">summarize</code>, <code class="highlighter-rouge">group_by</code>, and <code class="highlighter-rouge">count</code> to split a data frame into groups of observations, apply a summary statistics for each group, and then combine the results.</p>
</li>
	
	<li><p>Describe the concept of a wide and a long table format and for which purpose those formats are useful.</p>
</li>
	
	<li><p>Describe what key-value pairs are.</p>
</li>
	
	<li><p>Reshape a data frame from long to wide format and back with the <code class="highlighter-rouge">spread</code> and <code class="highlighter-rouge">gather</code> commands from the <strong><code class="highlighter-rouge">tidyr</code></strong> package.</p>
</li>
	
	<li><p>Export a data frame to a csv file.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h1 id="data-manipulation-using-dplyr-and-tidyr">Data Manipulation using <strong><code class="highlighter-rouge">dplyr</code></strong> and <strong><code class="highlighter-rouge">tidyr</code></strong></h1>

<p><strong><code class="highlighter-rouge">dplyr</code></strong> is a package for making tabular data manipulation easier by using a
limited set of functions that can be combined to extract and summarize insights from your data. It pairs nicely with <strong><code class="highlighter-rouge">tidyr</code></strong> which enables you to
swiftly convert between different data formats (long vs. wide) for plotting and analysis.</p>

<p>Similarly to <strong><code class="highlighter-rouge">readr</code></strong>, <strong><code class="highlighter-rouge">dplyr</code></strong> and <strong><code class="highlighter-rouge">tidyr</code></strong> are also part of the tidyverse. These packages were loaded in R’s memory when we called <code class="highlighter-rouge">library(tidyverse)</code> earlier.</p>

<h2 id="what-are-dplyr-and-tidyr">What are <strong><code class="highlighter-rouge">dplyr</code></strong> and <strong><code class="highlighter-rouge">tidyr</code></strong>?</h2>

<p>The package <strong><code class="highlighter-rouge">dplyr</code></strong> provides easy tools for the most common data
manipulation tasks. It is built to work directly with data frames, with many
common tasks optimized by being written in a compiled language (C++). An
additional feature is the ability to work directly with data stored in an
external database. The benefits of doing this are that the data can be managed
natively in a relational database, queries can be conducted on that database,
and only the results of the query are returned.</p>

<p>This addresses a common problem with R in that all operations are conducted
in-memory and thus the amount of data you can work with is limited by available
memory. The database connections essentially remove that limitation in that you
can connect to a database of many hundreds of GB, conduct queries on it
directly, and pull back into R only what you need for analysis.</p>

<p>The package <strong><code class="highlighter-rouge">tidyr</code></strong> addresses the common problem of wanting to reshape your data for plotting and use by different R functions. Sometimes we want data sets where we have one row per measurement. Sometimes we want a data frame where each measurement type has its own column, and rows are instead more aggregated groups. Moving back and forth between these formats is nontrivial, and <strong><code class="highlighter-rouge">tidyr</code></strong> gives you tools for this and more sophisticated  data manipulation.</p>

<p>To learn more about <strong><code class="highlighter-rouge">dplyr</code></strong> and <strong><code class="highlighter-rouge">tidyr</code></strong> after the workshop, you may want to check out this
<a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">handy data transformation with <strong><code class="highlighter-rouge">dplyr</code></strong> cheatsheet</a> and this <a href="https://github.com/rstudio/cheatsheets/raw/master/data-import.pdf">one about <strong><code class="highlighter-rouge">tidyr</code></strong></a>.</p>

<p>To make sure, everyone will use the same dataset for this lesson, we’ll read again the SAFI dataset that we downloaded earlier.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## load the tidyverse</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">

</span><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"data/placement_1.csv"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">country</span><span class="p">))</span><span class="w"> </span><span class="c1"># changes the country variable to a factor</span><span class="w">

</span><span class="c1">## inspect the data</span><span class="w">
</span><span class="n">test_results_1</span><span class="w">

</span><span class="c1">## preview the data</span><span class="w">
</span><span class="c1"># View(interviews)</span><span class="w">

</span><span class="c1">## summarize the data</span><span class="w">
</span><span class="c1"># summary(test_results_1)</span><span class="w">
</span><span class="c1"># skimr::skim(test_results_1)</span><span class="w">
</span></code></pre></div></div>

<p>We’re going to learn some of the most common <strong><code class="highlighter-rouge">dplyr</code></strong> functions:</p>

<ul>
  <li><code class="highlighter-rouge">select()</code>: subset columns</li>
  <li><code class="highlighter-rouge">filter()</code>: subset rows on conditions</li>
  <li><code class="highlighter-rouge">mutate()</code>: create new columns by using information from other columns</li>
  <li><code class="highlighter-rouge">group_by()</code> and <code class="highlighter-rouge">summarize()</code>: create summary statistics on grouped data</li>
  <li><code class="highlighter-rouge">arrange()</code>: sort results</li>
  <li><code class="highlighter-rouge">count()</code>: count discrete values</li>
</ul>

<h2 id="creating-new-variables">Creating new variables</h2>

<h3 id="mutate">Mutate</h3>

<p>Frequently you’ll want to create new columns based on the values in existing
columns, for example to scale test scores or to create total scores. 
For this we’ll use <code class="highlighter-rouge">mutate()</code>.</p>

<p>We currently have a dataframe with information for each test taker about country 
of origin and how they responded (correct or incorrect) to each of the items on 
the test. We are missing total score columns. We know from inspecting our dataframe
that our items are in columns <code class="highlighter-rouge">5:74</code>. The <code class="highlighter-rouge">.</code> in front of the column indices is a 
placeholder for the dataframe <code class="highlighter-rouge">test_results_1</code>. It is similar to the command
<code class="highlighter-rouge">test_results[,5:74]</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">raw_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">5</span><span class="o">:</span><span class="m">74</span><span class="p">]))</span><span class="w">

</span><span class="c1"># print the vector</span><span class="w">
</span><span class="n">test_results_1</span><span class="o">$</span><span class="n">raw_total</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 38 32 32 49 38 36 37 39 37 34 40 26 34 32 38 61 56 51 45 48 54 27 39
[24] 49 44 47 52 32 51 31 42 60 33 40 57 48 38 25 45 47 43 53 33 29 47 48
[47] 54 63 57 48 36 50 46 54 38 44 43 42 20 20 39 51 44 43 49 21 48 51 31
[70] 42 21 55 57 65 60 34 47 52 29 26 38 47 51 58 27 24 38 14
</code></pre></div></div>

<p>Often, we want to report scores that have been scaled in some way, such as percents.
Now that we have a <code class="highlighter-rouge">raw_total</code> column, we can create a column called <code class="highlighter-rouge">percent_total</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">percent_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">raw_total</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="m">70</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">

</span><span class="c1"># print the vector</span><span class="w">
</span><span class="n">test_results_1</span><span class="o">$</span><span class="n">percent_total</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 54.28571 45.71429 45.71429 70.00000 54.28571 51.42857 52.85714
 [8] 55.71429 52.85714 48.57143 57.14286 37.14286 48.57143 45.71429
[15] 54.28571 87.14286 80.00000 72.85714 64.28571 68.57143 77.14286
[22] 38.57143 55.71429 70.00000 62.85714 67.14286 74.28571 45.71429
[29] 72.85714 44.28571 60.00000 85.71429 47.14286 57.14286 81.42857
[36] 68.57143 54.28571 35.71429 64.28571 67.14286 61.42857 75.71429
[43] 47.14286 41.42857 67.14286 68.57143 77.14286 90.00000 81.42857
[50] 68.57143 51.42857 71.42857 65.71429 77.14286 54.28571 62.85714
[57] 61.42857 60.00000 28.57143 28.57143 55.71429 72.85714 62.85714
[64] 61.42857 70.00000 30.00000 68.57143 72.85714 44.28571 60.00000
[71] 30.00000 78.57143 81.42857 92.85714 85.71429 48.57143 67.14286
[78] 74.28571 41.42857 37.14286 54.28571 67.14286 72.85714 82.85714
[85] 38.57143 34.28571 54.28571 20.00000
</code></pre></div></div>

<h2 id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows</h2>

<p>To select columns of a
data frame, use <code class="highlighter-rouge">select()</code>. The first argument to this function is the data
frame (<code class="highlighter-rouge">test_results_1</code>), and the subsequent arguments are the columns to keep.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">raw_total</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To choose rows based on a specific criteria, use <code class="highlighter-rouge">filter()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"china"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 36 x 76
      ID names country admin_date          q1_list_mi q2_list_det
   &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;   &lt;dttm&gt;                   &lt;dbl&gt;       &lt;dbl&gt;
 1   635 JUDr… china   1960-12-25 22:02:34          1           1
 2   636 pan … china   1985-10-07 21:18:00          0           1
 3   637 Nadě… china   1987-12-22 17:04:22          1           0
 4   638 Mári… china   1983-10-31 10:23:45          0           1
 5   639 MUDr… china   1930-12-28 11:00:55          1           1
 6   640 Anež… china   1978-08-16 01:04:50          1           0
 7   641 Magd… china   2011-01-12 04:11:12          0           1
 8   642 Alžb… china   1977-11-19 01:12:51          0           0
 9   643 Lubo… china   2012-07-30 10:15:54          0           0
10   644 Sára… china   1963-05-19 22:58:51          0           1
# … with 26 more rows, and 70 more variables: q3_list_det &lt;dbl&gt;,
#   q4_list_det &lt;dbl&gt;, q5_list_det &lt;dbl&gt;, q6_list_det &lt;dbl&gt;,
#   q7_list_det &lt;dbl&gt;, q8_list_det &lt;dbl&gt;, q9_list_det &lt;dbl&gt;,
#   q10_list_mi &lt;dbl&gt;, q11_list_det &lt;dbl&gt;, q12_list_mi &lt;dbl&gt;,
#   q13_list_prag &lt;dbl&gt;, q14_list_det &lt;dbl&gt;, q15_list_det &lt;dbl&gt;,
#   q16_list_det &lt;dbl&gt;, q17_list_inf &lt;dbl&gt;, q18_list_inf &lt;dbl&gt;,
#   q19_list_det &lt;dbl&gt;, q20_list_mi &lt;dbl&gt;, q21_list_det &lt;dbl&gt;,
#   q22_list_prag &lt;dbl&gt;, q23_list_mi &lt;dbl&gt;, q24_list_det &lt;dbl&gt;,
#   q25_list_prag &lt;dbl&gt;, q26_list_det_an &lt;dbl&gt;, q27_list_det_an &lt;dbl&gt;,
#   q28_list_det_an &lt;dbl&gt;, q29_list_prag_an &lt;dbl&gt;, q30_list_mi_an &lt;dbl&gt;,
#   q31_list_mi_an &lt;dbl&gt;, q32_list_det_an &lt;dbl&gt;, q33_list_det &lt;dbl&gt;,
#   q34_list_prag_an &lt;dbl&gt;, q35_list_inf_an &lt;dbl&gt;, q36_read_mi &lt;dbl&gt;,
#   q37_read_det &lt;dbl&gt;, q38_read_det &lt;dbl&gt;, q39_read_mi &lt;dbl&gt;,
#   q40_read_voc &lt;dbl&gt;, q41_read_voc &lt;dbl&gt;, q42_read_mi &lt;dbl&gt;,
#   q43_read_det &lt;dbl&gt;, q44_read_mi &lt;dbl&gt;, q45_read_det &lt;dbl&gt;,
#   q46_read_mi &lt;dbl&gt;, q47_read_trog &lt;dbl&gt;, q48_read_det &lt;dbl&gt;,
#   q49_read_det &lt;dbl&gt;, q50_read_voc &lt;dbl&gt;, q51_read_torg &lt;dbl&gt;,
#   q52_read_inf &lt;dbl&gt;, q53_read_torg &lt;dbl&gt;, q54_read_det &lt;dbl&gt;,
#   q55_read_torg &lt;dbl&gt;, q56_read_purp &lt;dbl&gt;, q57_read_purp &lt;dbl&gt;,
#   q58_read_mi &lt;dbl&gt;, q59_read_inf &lt;dbl&gt;, q60_read_det_an &lt;dbl&gt;,
#   q61_read_purp_an &lt;dbl&gt;, q62_read_voc_an &lt;dbl&gt;, q63_read_inf_an &lt;dbl&gt;,
#   q64_read_mi_an &lt;dbl&gt;, q65_read_torg_an &lt;dbl&gt;, q66_read_torg_an &lt;dbl&gt;,
#   q67_read_purp_an &lt;dbl&gt;, q68_read_mi_an &lt;dbl&gt;, q69_read_det_an &lt;dbl&gt;,
#   q70_read_det_an &lt;dbl&gt;, raw_total &lt;dbl&gt;, percent_total &lt;dbl&gt;
</code></pre></div></div>

<p>The <code class="highlighter-rouge">!</code> symbol negates the result; we can use that to filter out all
test takers from China.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'china'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 52 x 76
      ID names country admin_date          q1_list_mi q2_list_det
   &lt;dbl&gt; &lt;chr&gt; &lt;fct&gt;   &lt;dttm&gt;                   &lt;dbl&gt;       &lt;dbl&gt;
 1   671 Deni… morocco 1950-02-04 19:06:32          1           1
 2   672 Bože… morocco 1998-08-20 22:56:09          0           1
 3   673 Pavl… morocco 2018-07-15 11:01:39          1           1
 4   674 Patr… morocco 1963-05-14 02:37:10          1           1
 5   675 Maty… morocco 2006-09-19 11:46:42          1           0
 6   676 Vlad… morocco 1929-12-15 00:30:38          1           1
 7   677 Milu… morocco 1961-02-22 22:13:36          0           0
 8   678 Niko… morocco 1986-01-08 07:12:44          0           1
 9   679 Ing.… morocco 2005-04-08 10:43:11          1           0
10   680 Davi… morocco 2002-03-14 20:02:29          1           1
# … with 42 more rows, and 70 more variables: q3_list_det &lt;dbl&gt;,
#   q4_list_det &lt;dbl&gt;, q5_list_det &lt;dbl&gt;, q6_list_det &lt;dbl&gt;,
#   q7_list_det &lt;dbl&gt;, q8_list_det &lt;dbl&gt;, q9_list_det &lt;dbl&gt;,
#   q10_list_mi &lt;dbl&gt;, q11_list_det &lt;dbl&gt;, q12_list_mi &lt;dbl&gt;,
#   q13_list_prag &lt;dbl&gt;, q14_list_det &lt;dbl&gt;, q15_list_det &lt;dbl&gt;,
#   q16_list_det &lt;dbl&gt;, q17_list_inf &lt;dbl&gt;, q18_list_inf &lt;dbl&gt;,
#   q19_list_det &lt;dbl&gt;, q20_list_mi &lt;dbl&gt;, q21_list_det &lt;dbl&gt;,
#   q22_list_prag &lt;dbl&gt;, q23_list_mi &lt;dbl&gt;, q24_list_det &lt;dbl&gt;,
#   q25_list_prag &lt;dbl&gt;, q26_list_det_an &lt;dbl&gt;, q27_list_det_an &lt;dbl&gt;,
#   q28_list_det_an &lt;dbl&gt;, q29_list_prag_an &lt;dbl&gt;, q30_list_mi_an &lt;dbl&gt;,
#   q31_list_mi_an &lt;dbl&gt;, q32_list_det_an &lt;dbl&gt;, q33_list_det &lt;dbl&gt;,
#   q34_list_prag_an &lt;dbl&gt;, q35_list_inf_an &lt;dbl&gt;, q36_read_mi &lt;dbl&gt;,
#   q37_read_det &lt;dbl&gt;, q38_read_det &lt;dbl&gt;, q39_read_mi &lt;dbl&gt;,
#   q40_read_voc &lt;dbl&gt;, q41_read_voc &lt;dbl&gt;, q42_read_mi &lt;dbl&gt;,
#   q43_read_det &lt;dbl&gt;, q44_read_mi &lt;dbl&gt;, q45_read_det &lt;dbl&gt;,
#   q46_read_mi &lt;dbl&gt;, q47_read_trog &lt;dbl&gt;, q48_read_det &lt;dbl&gt;,
#   q49_read_det &lt;dbl&gt;, q50_read_voc &lt;dbl&gt;, q51_read_torg &lt;dbl&gt;,
#   q52_read_inf &lt;dbl&gt;, q53_read_torg &lt;dbl&gt;, q54_read_det &lt;dbl&gt;,
#   q55_read_torg &lt;dbl&gt;, q56_read_purp &lt;dbl&gt;, q57_read_purp &lt;dbl&gt;,
#   q58_read_mi &lt;dbl&gt;, q59_read_inf &lt;dbl&gt;, q60_read_det_an &lt;dbl&gt;,
#   q61_read_purp_an &lt;dbl&gt;, q62_read_voc_an &lt;dbl&gt;, q63_read_inf_an &lt;dbl&gt;,
#   q64_read_mi_an &lt;dbl&gt;, q65_read_torg_an &lt;dbl&gt;, q66_read_torg_an &lt;dbl&gt;,
#   q67_read_purp_an &lt;dbl&gt;, q68_read_mi_an &lt;dbl&gt;, q69_read_det_an &lt;dbl&gt;,
#   q70_read_det_an &lt;dbl&gt;, raw_total &lt;dbl&gt;, percent_total &lt;dbl&gt;
</code></pre></div></div>

<p>We can also select columns based on their names or on partial matches to their names.
If we wanted only the listening test items:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_list_"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 88 x 35
   q1_list_mi q2_list_det q3_list_det q4_list_det q5_list_det q6_list_det
        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
 1          1           1           1           0           0           1
 2          0           1           1           0           0           1
 3          1           0           1           0           1           1
 4          0           1           1           1           1           1
 5          1           1           0           1           0           1
 6          1           0           1           1           0           1
 7          0           1           0           0           0           1
 8          0           0           0           1           0           1
 9          0           0           0           1           0           1
10          0           1           0           0           0           1
# … with 78 more rows, and 29 more variables: q7_list_det &lt;dbl&gt;,
#   q8_list_det &lt;dbl&gt;, q9_list_det &lt;dbl&gt;, q10_list_mi &lt;dbl&gt;,
#   q11_list_det &lt;dbl&gt;, q12_list_mi &lt;dbl&gt;, q13_list_prag &lt;dbl&gt;,
#   q14_list_det &lt;dbl&gt;, q15_list_det &lt;dbl&gt;, q16_list_det &lt;dbl&gt;,
#   q17_list_inf &lt;dbl&gt;, q18_list_inf &lt;dbl&gt;, q19_list_det &lt;dbl&gt;,
#   q20_list_mi &lt;dbl&gt;, q21_list_det &lt;dbl&gt;, q22_list_prag &lt;dbl&gt;,
#   q23_list_mi &lt;dbl&gt;, q24_list_det &lt;dbl&gt;, q25_list_prag &lt;dbl&gt;,
#   q26_list_det_an &lt;dbl&gt;, q27_list_det_an &lt;dbl&gt;, q28_list_det_an &lt;dbl&gt;,
#   q29_list_prag_an &lt;dbl&gt;, q30_list_mi_an &lt;dbl&gt;, q31_list_mi_an &lt;dbl&gt;,
#   q32_list_det_an &lt;dbl&gt;, q33_list_det &lt;dbl&gt;, q34_list_prag_an &lt;dbl&gt;,
#   q35_list_inf_an &lt;dbl&gt;
</code></pre></div></div>

<h2 id="pipes">Pipes</h2>

<p>What if you want to select and filter at the same time? There are three
ways to do this: use intermediate steps, nested functions, or pipes.</p>

<p>With intermediate steps, you create a temporary data frame and use
that as input to the next function, like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_china</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'china'</span><span class="p">)</span><span class="w">
</span><span class="n">totals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">test_results_china</span><span class="p">,</span><span class="w"> </span><span class="n">raw_total</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This is readable, but can clutter up your workspace with lots of objects that you have to name individually. With multiple steps, that can be hard to keep track of.</p>

<p><em>Pipes</em> are a recent addition to R. Pipes let you take the
output of one function and send it directly to the next, which is useful when
you need to do many things to the same dataset. Pipes in R look like <code class="highlighter-rouge">%&gt;%</code> and
are made available via the <strong><code class="highlighter-rouge">magrittr</code></strong> package, installed automatically with
<strong><code class="highlighter-rouge">dplyr</code></strong>. If you use RStudio, you can type the pipe with <kbd>Ctrl</kbd></p>
<ul>
  <li><kbd>Shift</kbd> + <kbd>M</kbd> if you have a PC or <kbd>Cmd</kbd> +
<kbd>Shift</kbd> + <kbd>M</kbd> if you have a Mac.</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"china"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">raw_total</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 36 x 2
   country raw_total
   &lt;fct&gt;       &lt;dbl&gt;
 1 china          38
 2 china          32
 3 china          32
 4 china          49
 5 china          38
 6 china          36
 7 china          37
 8 china          39
 9 china          37
10 china          34
# … with 26 more rows
</code></pre></div></div>

<p>In the above code, we use the pipe to send the <code class="highlighter-rouge">test_results_1</code> dataset first
through <code class="highlighter-rouge">filter()</code> to keep rows where <code class="highlighter-rouge">country</code> is “china”, then through
<code class="highlighter-rouge">select()</code> to keep only the <code class="highlighter-rouge">country</code> and <code class="highlighter-rouge">raw_total</code> columns. Since <code class="highlighter-rouge">%&gt;%</code>
takes the object on its left and passes it as the first argument to the function
on its right, we don’t need to explicitly include the data frame as an argument
to the <code class="highlighter-rouge">filter()</code> and <code class="highlighter-rouge">select()</code> functions any more.</p>

<p>Some may find it helpful to read the pipe like the word “then”. For instance,
in the above example, we take the data frame <code class="highlighter-rouge">test_results_1</code>, <em>then</em> we <code class="highlighter-rouge">filter</code>
for rows with <code class="highlighter-rouge">country == "china"</code>, <em>then</em> we <code class="highlighter-rouge">select</code> columns <code class="highlighter-rouge">country</code> and <code class="highlighter-rouge">raw_total</code>. 
The <strong><code class="highlighter-rouge">dplyr</code></strong> functions by themselves are somewhat simple,
but by combining them into linear workflows with the pipe, we can accomplish
more complex manipulations of data frames.</p>

<p>If we want to create a new object with this smaller version of the data, we
can assign it a new name:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_china</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"china"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">raw_total</span><span class="p">)</span><span class="w">

</span><span class="n">test_results_china</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 36 x 2
   country raw_total
   &lt;fct&gt;       &lt;dbl&gt;
 1 china          38
 2 china          32
 3 china          32
 4 china          49
 5 china          38
 6 china          36
 7 china          37
 8 china          39
 9 china          37
10 china          34
# … with 26 more rows
</code></pre></div></div>

<p>Note that the final data frame (<code class="highlighter-rouge">test_results_china</code>) is the leftmost part of this expression.</p>

<blockquote class="challenge">
  <h2 id="exercise">Exercise</h2>

  <p>Using pipes, subset the <code class="highlighter-rouge">test_results_1</code> data to include raw_totals
for test takers from morocco. Then select the <code class="highlighter-rouge">country</code> and <code class="highlighter-rouge">percent_total</code> columns.</p>

  <blockquote class="solution">
    <h2 id="solution">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_morocco</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"morocco"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">percent_total</span><span class="p">)</span><span class="w">

</span><span class="n">test_results_morocco</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 20 x 2
   country percent_total
   &lt;fct&gt;           &lt;dbl&gt;
 1 morocco          54.3
 2 morocco          35.7
 3 morocco          64.3
 4 morocco          67.1
 5 morocco          61.4
 6 morocco          75.7
 7 morocco          47.1
 8 morocco          41.4
 9 morocco          67.1
10 morocco          68.6
11 morocco          77.1
12 morocco          90  
13 morocco          81.4
14 morocco          68.6
15 morocco          51.4
16 morocco          71.4
17 morocco          65.7
18 morocco          77.1
19 morocco          54.3
20 morocco          62.9
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>You can also filter numerical data using other logical operators (such as <code class="highlighter-rouge">&gt;</code>, <code class="highlighter-rouge">&lt;=</code>). 
For example, if you wanted data from test takers who scored above a certain score.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_70</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">percent_total</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">70</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">select</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">percent_total</span><span class="p">)</span><span class="w">

</span><span class="n">test_results_70</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 26 x 2
   country percent_total
   &lt;fct&gt;           &lt;dbl&gt;
 1 china            70  
 2 china            87.1
 3 china            80  
 4 china            72.9
 5 china            77.1
 6 china            70  
 7 china            74.3
 8 china            72.9
 9 china            85.7
10 china            81.4
# … with 16 more rows
</code></pre></div></div>

<p>We can use <code class="highlighter-rouge">mutate</code> to create total scores for the listening and reading tests.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">list_raw_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_list_"</span><span class="p">))))</span><span class="w"> 

</span><span class="n">test_results_1</span><span class="o">$</span><span class="n">list_raw_total</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code> [1] 20 13 20 28 20 19 16 20 20 20 19  9 17 16 21 31 28 28 24 27 26 11 24
[24] 28 15 25 26 15 26 20 23 29 16 20 29 25 16 13 25 22 19 28 15 12 22 21
[47] 25 32 25 24 18 27 22 29 13 26 16 21 10  9 20 22 22 20 21 12 24 28 15
[70] 23 13 24 27 32 29 18 23 29 14 12 17 24 28 31 12  6 18  6
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-1">Exercise</h2>

  <p>Using pipes, create a <code class="highlighter-rouge">read_raw_total</code> column in our dataframe. Then <code class="highlighter-rouge">select</code> all of the columns
that contain raw scores.</p>

  <blockquote class="solution">
    <h2 id="solution-1">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
 </span><span class="n">mutate</span><span class="p">(</span><span class="n">read_raw_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_read_"</span><span class="p">))))</span><span class="w"> 

</span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
 </span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"raw"</span><span class="p">))</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 88 x 3
   raw_total list_raw_total read_raw_total
       &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
 1        38             20             18
 2        32             13             19
 3        32             20             12
 4        49             28             21
 5        38             20             18
 6        36             19             17
 7        37             16             21
 8        39             20             19
 9        37             20             17
10        34             20             14
# … with 78 more rows
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h3 id="split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the summarize() function</h3>

<p>Many data analysis tasks can be approached using the <em>split-apply-combine</em>
paradigm: split the data into groups, apply some analysis to each group, and
then combine the results. <strong><code class="highlighter-rouge">dplyr</code></strong> makes this very easy through the use of
the <code class="highlighter-rouge">group_by()</code> function.</p>

<h4 id="the-summarize-function">The <code class="highlighter-rouge">summarize()</code> function</h4>

<p><code class="highlighter-rouge">group_by()</code> is often used together with <code class="highlighter-rouge">summarize()</code>, which collapses each
group into a single-row summary of that group.  <code class="highlighter-rouge">group_by()</code> takes as arguments
the column names that contain the <strong>categorical</strong> variables for which you want
to calculate the summary statistics. So to compute the average raw test score by country
of origin:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">raw_total</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  country  mean
  &lt;fct&gt;   &lt;dbl&gt;
1 china    41.9
2 morocco  44.9
3 russia   40.2
</code></pre></div></div>

<p>You may also have noticed that the output from these calls doesn’t run off the
screen anymore. It’s one of the advantages of <code class="highlighter-rouge">tbl_df</code> over data frame.</p>

<p>Once the data are grouped, you can create multiple summary statistics at a time.
For example, we may want an indicator of dispersion in addition to central tendancy:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w">
              </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w"> 
              </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w">
              </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">raw_total</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 5
  country  mean    sd   min   max
  &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 china    41.9  9.40    26    61
2 morocco  44.9  9.54    25    63
3 russia   40.2 13.6     14    65
</code></pre></div></div>

<p>It is sometimes useful to rearrange the result of a query to inspect the values. For instance, we can sort on <code class="highlighter-rouge">min</code> to put the group with the lowest minimum score first.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w">
              </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w"> 
              </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w">
              </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">raw_total</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">min</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 5
  country  mean    sd   min   max
  &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 russia   40.2 13.6     14    65
2 morocco  44.9  9.54    25    63
3 china    41.9  9.40    26    61
</code></pre></div></div>

<p>To sort in descending order, we need to add the <code class="highlighter-rouge">desc()</code> function. If we want to sort the results by decreasing order of minimum household size:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarize</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w">
              </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w"> 
              </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">raw_total</span><span class="p">),</span><span class="w">
              </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">raw_total</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">min</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 5
  country  mean    sd   min   max
  &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 china    41.9  9.40    26    61
2 morocco  44.9  9.54    25    63
3 russia   40.2 13.6     14    65
</code></pre></div></div>

<h4 id="counting">Counting</h4>

<p>When working with data, we often want to know the number of observations found
for each factor or combination of factors. For this task, <strong><code class="highlighter-rouge">dplyr</code></strong> provides
<code class="highlighter-rouge">count()</code>. For example, if we wanted to count the number of rows of data for
each country of origin, we would do:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  country     n
  &lt;fct&gt;   &lt;int&gt;
1 china      36
2 morocco    20
3 russia     32
</code></pre></div></div>

<p>For convenience, <code class="highlighter-rouge">count()</code> provides the <code class="highlighter-rouge">sort</code> argument to get results from most to least:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">count</span><span class="p">(</span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  country     n
  &lt;fct&gt;   &lt;int&gt;
1 china      36
2 russia     32
3 morocco    20
</code></pre></div></div>

<p>Within the <code class="highlighter-rouge">summarise</code> function we can use <code class="highlighter-rouge">group_by</code> and <code class="highlighter-rouge">n()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 2
  country     n
  &lt;fct&gt;   &lt;int&gt;
1 china      36
2 morocco    20
3 russia     32
</code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-2">Exercise</h2>

  <ol>
    <li>What are the <code class="highlighter-rouge">n</code>, <code class="highlighter-rouge">mean</code>, <code class="highlighter-rouge">median</code>, <code class="highlighter-rouge">sd</code>, and range (hint: range = (<code class="highlighter-rouge">max</code> - <code class="highlighter-rouge">min</code>) + 1) of the
<code class="highlighter-rouge">percent_total</code> scores?</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-2">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w">
             </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">percent_total</span><span class="p">),</span><span class="w">
             </span><span class="n">median</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">percent_total</span><span class="p">),</span><span class="w">
             </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">percent_total</span><span class="p">),</span><span class="w">
             </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">percent_total</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">percent_total</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 1 x 5
      n  mean median    sd range
  &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    88  60.0   61.4  15.9  73.9
</code></pre></div>    </div>
  </blockquote>

  <ol>
    <li>Use <code class="highlighter-rouge">group_by()</code> to calculate the same summary statistics for test takers
by country of origin.</li>
  </ol>

  <blockquote class="solution">
    <h2 id="solution-3">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">group_by</span><span class="p">(</span><span class="n">country</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
   </span><span class="n">summarise</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w">
             </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">percent_total</span><span class="p">),</span><span class="w">
             </span><span class="n">median</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">percent_total</span><span class="p">),</span><span class="w">
             </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">percent_total</span><span class="p">),</span><span class="w">
             </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">percent_total</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">percent_total</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 3 x 6
  country     n  mean median    sd range
  &lt;fct&gt;   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 china      36  59.9   56.4  13.4  51.0
2 morocco    20  64.1   66.4  13.6  55.3
3 russia     32  57.5   60.7  19.4  73.9
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<h2 id="reshaping-with-gather-and-spread">Reshaping with gather and spread</h2>

<p>So far, we have been working with “tidy” data (see Hadley Wickhams Tidy Data
manuscript for more information <a href="https://vita.had.co.nz/papers/tidy-data.pdf">https://vita.had.co.nz/papers/tidy-data.pdf</a>).
Four characteristics of a tidy dataset include the following:</p>

<ol>
  <li>Each variable has its own column</li>
  <li>Each observation has its own row</li>
  <li>Each value must have its own cell</li>
  <li>Each type of observational unit forms a table</li>
</ol>

<p>Here we examine the fourth rule: Each type of observational unit forms a table.</p>

<p>In <code class="highlighter-rouge">test_results_1</code>, each row contains the values of variables associated with each
record (the unit), values such as correct or incorrect responses and total and part scores. 
What if instead of comparing records, we wanted to look at differences in test takers grouped by 
different countries of origin or across different subtests (i.e., listening and reading)?</p>

<p>We’d need to create a new table where each row (the unit) is comprised
of values of variables associated with each country of origin (e.g. for
<code class="highlighter-rouge">country</code>). In practical terms this means the values of the countries of 
origin in <code class="highlighter-rouge">country</code> would become the names of column variables and the cells 
would contain <code class="highlighter-rouge">TRUE</code> or <code class="highlighter-rouge">FALSE</code>.</p>

<p>Having created a new table, we can now explore the relationship within and
between countries of origin. The key point here is that we are still following 
a tidy data structure, but we have <strong>reshaped</strong> the data according to the observations 
of interest.</p>

<p>The opposite transformation would be to transform column names into values of
a variable.</p>

<p>We can do both these of transformations with two <code class="highlighter-rouge">tidyr</code> functions, <code class="highlighter-rouge">spread()</code>
and <code class="highlighter-rouge">gather()</code>.</p>

<h4 id="gathering">Gathering</h4>

<p>In this situation we are gathering the column names and turning them into a pair
of new variables. One variable represents the column names as values, and the
other variable contains the values previously associated with the column names.
We will do this in two steps to make this process a bit clearer.</p>

<p><code class="highlighter-rouge">gather()</code> takes four principal arguments:</p>

<ol>
  <li>the data</li>
  <li>the <em>key</em> column variable we wish to create from column names.</li>
  <li>the <em>value</em> column variable we wish to create and fill with values
associated with the key.</li>
  <li>the names of the columns we use to fill the key variable (or to drop).</li>
</ol>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">raw_total</span><span class="p">,</span><span class="w"> </span><span class="n">percent_total</span><span class="p">,</span><span class="w"> </span><span class="n">list_raw_total</span><span class="p">,</span><span class="w"> </span><span class="n">read_raw_total</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">country</span><span class="p">)</span><span class="w">

</span><span class="n">test_results_1_long</span><span class="w">
</span></code></pre></div></div>

<div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 352 x 4
      ID country key       value
   &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;     &lt;dbl&gt;
 1   635 china   raw_total    38
 2   636 china   raw_total    32
 3   637 china   raw_total    32
 4   638 china   raw_total    49
 5   639 china   raw_total    38
 6   640 china   raw_total    36
 7   641 china   raw_total    37
 8   642 china   raw_total    39
 9   643 china   raw_total    37
10   644 china   raw_total    34
# … with 342 more rows
</code></pre></div></div>

<h4 id="spreading">Spreading</h4>

<p><code class="highlighter-rouge">spread()</code> takes three principal arguments:</p>

<ol>
  <li>the data</li>
  <li>the <em>key</em> column variable whose values will become new column names.</li>
  <li>the <em>value</em> column variable whose values will fill the new column variables.</li>
</ol>

<p>Further arguments include <code class="highlighter-rouge">fill</code> which, if set, fills in missing values with
the value provided.</p>

<p>We can return our long dataframe back into a wide dataframe with <code class="highlighter-rouge">spread</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">results_wide</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">spread</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="joining-data">Joining data</h3>

<p>Sometimes it is necessary to separate pieces of our data, perform operations on them
and then join them back together with the original dataframe. For today, we will work 
with <code class="highlighter-rouge">full_join</code> from <code class="highlighter-rouge">dplyr</code>. Our goal is to calculate the raw total scores for the
reading and listening anchor sets in our data. We will leverage the <code class="highlighter-rouge">select</code> and 
<code class="highlighter-rouge">rowSums</code> commands again:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">list_1_an</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_list_"</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_an"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">list_an_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">10</span><span class="p">]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">list_an_raw</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can use <code class="highlighter-rouge">full_join</code> to add <code class="highlighter-rouge">list_an_raw</code> back to the original dataframe. This command
takes three arguments. <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code> are the tables to join. <code class="highlighter-rouge">by</code> is character vector:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">full_join</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">list_1_an</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ID'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<blockquote class="challenge">
  <h2 id="exercise-3">Exercise</h2>

  <p>Do the same operations as above to create a <code class="highlighter-rouge">read_an_raw</code> variable. Add it to the original dataframe. Then create
an new dataframe called <code class="highlighter-rouge">test_1_raw</code> that contains the <code class="highlighter-rouge">ID</code> and <code class="highlighter-rouge">country</code> variables and all columns with raw totals. 
(hint: there are a different number of items in the reading anchor test than in the listening anchor test.)</p>

  <blockquote class="solution">
    <h2 id="solution-4">Solution</h2>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">read_1_an</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">test_results_1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_read_"</span><span class="p">))</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"_an"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">read_an_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">2</span><span class="o">:</span><span class="m">12</span><span class="p">]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">read_an_raw</span><span class="p">)</span><span class="w">

</span><span class="n">test_results_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">full_join</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">read_1_an</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'ID'</span><span class="p">)</span><span class="w"> 

</span><span class="n">test_1_raw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">test_results_1</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"raw"</span><span class="p">))</span><span class="w">

</span><span class="n">test_1_raw</span><span class="w">
</span></code></pre></div>    </div>

    <div class="output highlighter-rouge"><div class="highlight"><pre class="highlight"><code># A tibble: 88 x 7
      ID country raw_total list_raw_total read_raw_total list_an_raw
   &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
 1   635 china          38             20             18           2
 2   636 china          32             13             19           1
 3   637 china          32             20             12           2
 4   638 china          49             28             21           8
 5   639 china          38             20             18           6
 6   640 china          36             19             17           4
 7   641 china          37             16             21           5
 8   642 china          39             20             19           7
 9   643 china          37             20             17           4
10   644 china          34             20             14           5
# … with 78 more rows, and 1 more variable: read_an_raw &lt;dbl&gt;
</code></pre></div>    </div>
  </blockquote>
</blockquote>

<p>Now we can save this data frame to our <code class="highlighter-rouge">data_output</code> directory.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">write_csv</span><span class="p">(</span><span class="n">test_1_raw</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data_output/test_1_raw_totals.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>



<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use the <code class="highlighter-rouge">dplyr</code> package to manipulate dataframes.</p>
</li>
    
    <li><p>Use <code class="highlighter-rouge">select()</code> to choose variables from a dataframe.</p>
</li>
    
    <li><p>Use <code class="highlighter-rouge">filter()</code> to choose data based on values.</p>
</li>
    
    <li><p>Use <code class="highlighter-rouge">group_by()</code> and <code class="highlighter-rouge">summarize()</code> to work with subsets of data.</p>
</li>
    
    <li><p>Use <code class="highlighter-rouge">mutate()</code> to create new variables.</p>
</li>
    
    <li><p>Use the <code class="highlighter-rouge">tidyr</code> package to change the layout of dataframes.</p>
</li>
    
    <li><p>Use <code class="highlighter-rouge">gather()</code> to go from wide to long format.</p>
</li>
    
    <li><p>Use <code class="highlighter-rouge">spread()</code> to go from long to wide format.</p>
</li>
    
  </ul>
</blockquote>

</article>
















<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../02-starting-with-data/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../04-ggplot2/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      
<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="">CC-BY 4.0</a> 2018–2019
	by <a href="https://carpentries.org/">The Carpentries</a>
        <br>
        Licensed under <a href="">CC-BY 4.0</a> 2016–2018
	by <a href="http://datacarpentry.org">Data Carpentry</a>
	
    </div>
    <div class="col-md-6 help-links" align="right">
	
	<a href="/edit/gh-pages/_episodes/03-dplyr-tidyr.md">Edit on GitHub</a>
	
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="mailto:team@carpentries.org">Contact</a>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

      
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
